---
- name: Install zsh, git, wget packages
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - zsh
    - git
    - wget
  become: yes

- name: Download zsh installer
  get_url:
    url: "{{ zsh_omz_url }}"
    dest: /tmp/zsh-installer.sh
    mode: 0777

- name: Execute the zsh-installer.sh
  shell: /tmp/zsh-installer.sh
  args:
    creates: "{{ lookup('env', 'HOME') }}/.oh-my-zsh"

- name: Download zplug installer
  get_url:
    url: "{{ zsh_zplug_url }}"
    dest: /tmp/zplug-installer.sh
    mode: 0777

- name: Execute the zplug-installer.sh
  shell: /tmp/zplug-installer.sh
  args:
    creates: "{{ lookup('env','HOME') }}/.zplug"

- name: Create .zshrc config
  template:
    src: zshrc.j2
    dest: "{{ zsh_dest }}"
    owner: "{{ lookup('env','USER') }}"
    backup: yes
  when: zsh_ansible_managed

- name: Set zsh as default shell
  user:
    name: "{{ lookup('env','USER') }}"
    shell: /bin/zsh
  become: true
